<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catalogo Hard Disk</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #eef2f7;
      color: #333;
      margin: 0;
      padding: 20px;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: auto;
      padding: 30px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
      font-size: 2.5em;
    }

    #summary-section {
      background-color: #f7f9fc;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    #summary-section h2 {
      margin-top: 0;
      font-size: 1.5em;
      color: #3498db;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .summary-card {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .summary-card h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.2em;
      color: #2c3e50;
    }

    .summary-card p {
      margin: 5px 0;
      font-size: 1em;
      color: #555;
    }

    .extension-item {
      display: flex;
      justify-content: space-between;
    }

    #hdd-size-summary .size-item {
      display: flex;
      justify-content: space-between;
    }

    #search-container {
      margin-bottom: 30px;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #searchInput {
      flex-grow: 1;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-right: 10px;
    }

    #searchButton {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      background-color: #3498db;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.1s;
    }

    #searchButton:hover {
      background-color: #2980b9;
    }

    #searchButton:active {
      transform: scale(0.98);
    }

    .hdd-section {
      margin-bottom: 15px;
      border-radius: 10px;
      background-color: #fafbfd;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      transition: box-shadow 0.3s;
    }

    .hdd-section:hover {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .hdd-title {
      font-size: 1.2em;
      font-weight: bold;
      color: #e74c3c;
      margin: 0;
      padding: 18px 25px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      background-color: #f7f9fc;
      transition: background-color 0.3s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .hdd-title:hover {
      background-color: #f0f4f8;
    }

    .hdd-details {
      font-size: 0.85em;
      font-weight: normal;
      color: #555;
      margin-left: 10px;
    }

    ul {
      margin: 0;
      padding-left: 20px;
    }

    li {
      margin: 2px 0;
    }

    li strong {
      color: #2c3e50;
    }

    .folder {
      cursor: pointer;
      user-select: none;
    }

    .file {
      color: #555;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Catalogo Hard Disk</h1>

    <div id="summary-section">
      <h2>Riepilogo Database</h2>
      <div class="summary-grid">
        <div class="summary-card">
          <h3>Statistiche File Video</h3>
          <p id="total-video-files">Totale file video: 0</p>
          <div id="video-extensions-summary"></div>
        </div>
        <div class="summary-card">
          <h3>Statistiche Spazio Dischi</h3>
          <p id="total-space-occupied">Totale spazio occupato: 0 GB</p>
          <p id="total-space-free">Totale spazio libero: 0 GB</p>
          <div id="hdd-size-summary">
            <p>Conteggio in base alle dimensioni del disco...</p>
          </div>
        </div>
      </div>
    </div>

    <div id="search-container">
      <input type="text" id="searchInput" placeholder="Cerca file per nome o percorso...">
      <button id="searchButton">Cerca</button>
    </div>
    <div id="results-container"></div>
  </div>

  <script>
    const HDD_JSON_MAP = {
      "Arietty": "data/Arietty.json",
      "SOA": "data/SOA.json",
      "Hikvision2TB": "data/Hikvision2TB.json",
      "TR3NTON": "data/TR3NTON.json",
      "Seagate1TB": "data/Seagate1TB.json",
      "Rufy": "data/Rufy.json",
      "Nami": "data/Nami.json",
      "Zoro": "data/Zoro.json",
      "Usopp": "data/usopp.json",
      "Franky": "data/franky.json",
      "NASWare": "data/NASWare.json",
      "Seagate0FM": "data/Seagate0FM.json",
      "Seagate878": "data/Seagate878.json",
      "SeagateGMF": "data/SeagateGMF.json",
      "SeagateR9H": "data/SeagateR9H.json",
      "WD207": "data/WD207.json",
      "Maxtor15G": "data/Maxtor15G.json",
      "WD_Sarah_2TB": "data/WD_Sarah_2TB.json",
    };

    let database = {};

    document.addEventListener("DOMContentLoaded", async () => {
      await loadDatabase();
      renderResults();
    });

    async function loadDatabase() {
      const fetchPromises = [];
      for (const hddName in HDD_JSON_MAP) {
        fetchPromises.push(
          fetch(HDD_JSON_MAP[hddName])
            .then(r => r.json())
            .then(data => {
              let files = [];
              let diskInfo = null;
              if (data.catalogo_video) files = data.catalogo_video;
              if (data.informazioni_disco) diskInfo = data.informazioni_disco;
              database[hddName] = { files, diskInfo };
            })
            .catch(() => {
              database[hddName] = { files: [], diskInfo: null };
            })
        );
      }
      await Promise.allSettled(fetchPromises);
    }

    function buildFileTree(files) {
      const root = {};
      files.forEach(file => {
        const parts = file.percorso_completo.split("\\");
        let current = root;
        parts.forEach((part, index) => {
          if (index === parts.length - 1) {
            if (!current.files) current.files = [];
            current.files.push({ name: part, size: file.dimensione });
          } else {
            if (!current[part]) current[part] = {};
            current = current[part];
          }
        });
      });
      return root;
    }

    function renderTree(node) {
      const ul = document.createElement("ul");

      for (const key in node) {
        if (key !== "files") {
          const li = document.createElement("li");
          li.innerHTML = `<span class="folder">ðŸ“‚ <strong>${key}</strong></span>`;
          const childUl = renderTree(node[key]);
          childUl.style.display = "none";
          li.appendChild(childUl);
          li.querySelector(".folder").addEventListener("click", () => {
            childUl.style.display = (childUl.style.display === "none") ? "block" : "none";
          });
          ul.appendChild(li);
        }
      }

      if (node.files) {
        node.files.forEach(file => {
          const li = document.createElement("li");
          li.className = "file";
          li.textContent = `ðŸ“„ ${file.name} (${file.size})`;
          ul.appendChild(li);
        });
      }

      return ul;
    }

    function renderResults() {
      const resultsContainer = document.getElementById("results-container");
      resultsContainer.innerHTML = "";

      for (const hddName in database) {
        const hddData = database[hddName];
        if (!hddData.files.length && !hddData.diskInfo) continue;

        const hddSection = document.createElement("div");
        hddSection.className = "hdd-section";

        const hddTitle = document.createElement("h2");
        hddTitle.className = "hdd-title";

        let titleText = hddName;
        if (hddData.diskInfo) {
          titleText += `  `;
          titleText += `<span class="hdd-details">Totale: ${hddData.diskInfo.totale} | Libero: ${hddData.diskInfo.libero}</span>`;
        }

        hddTitle.innerHTML = titleText;
        hddSection.appendChild(hddTitle);

        const fileTree = buildFileTree(hddData.files);
        const treeHtml = renderTree(fileTree);
        treeHtml.style.display = "none";

        hddTitle.addEventListener("click", () => {
          treeHtml.style.display = (treeHtml.style.display === "none") ? "block" : "none";
        });

        hddSection.appendChild(treeHtml);
        resultsContainer.appendChild(hddSection);
      }
    }
  </script>
</body>

</html>
